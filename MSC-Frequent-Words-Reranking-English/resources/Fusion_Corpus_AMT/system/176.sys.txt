But the bill was reached only after far more wrangling than the administration anticipated and with far less Republican support than it had pledged